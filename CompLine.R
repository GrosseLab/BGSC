# analysis -------------------------------------
# Run complete analysis for both
# PostClass799 <- PostClass
# PostClass767 <- PostClass

PAM50gene_names <- c("MDM2","EGFR","PGR","GRB7","RRM2","KRT5","BIRC5","CDCA1","PTTG1","BLVRA",  
                     "MKI67","NAT1","MYBL2","MAPT","CXXC5","FOXA1","ORC6L","MLPH","BCL2","MELK",   
                     "MYC","GPR160","CDC20","ANLN","UBE2T","CEP55","TMEM45B","TYMS","ERBB2","EXO1",   
                     "SFRP1","ESR1","FGFR4","MIA","MMP11","CCNB1","CCNE1","PHGDH","KNTC2","BAG1",   
                     "KRT14","UBE2C","CENPF","CDC6","KRT17","CDH3","ACTR3B","FOXC1","KIF2C","SLC39A6")

broadinstitute_Mutations <- function(){
  Cell_lines_annotations <- read.csv('/Users/weinhol/Promotion/DISSERTAION/PAPER/EGFR Paper/Review_BMC/broadinstitute_Mutations/Cell_lines_annotations_20181226.txt',sep = '\t',header = T)
  rownames(Cell_lines_annotations) <-  as.character(Cell_lines_annotations$CCLE_ID)
  Cell_lines_annotations_types <- table(Cell_lines_annotations$type)
  
  Cell_lines_annotations["SF767_CERVIX",]
  
  tmp <- Cell_lines_annotations[as.character(Cell_lines_annotations$type)=='glioma',]
  gliomaCL <- as.character(unique(as.character(tmp$CCLE_ID)))
  gliomaCL <- gliomaCL[!is.na(gliomaCL)]
  
  PIK3CA_mutations <- read.csv('/Users/weinhol/Promotion/DISSERTAION/PAPER/EGFR Paper/Review_BMC/broadinstitute_Mutations/PIK3CA_mutations_ALL.csv')
  EGF_mutations <- read.csv('/Users/weinhol/Promotion/DISSERTAION/PAPER/EGFR Paper/Review_BMC/broadinstitute_Mutations/EGF_mutations_ALL.csv')
  
  PIK3CA_mutations_NR <- sort(table(as.character(PIK3CA_mutations$Tumor.Sample.Barcode)))
  EGF_mutations_NR <- sort(table(as.character(EGF_mutations$Tumor.Sample.Barcode)))
  f.input2(names(PIK3CA_mutations_NR),names(EGF_mutations_NR),name=c('PIK3CA_mutations','EGF_mutations'))
  
  grepl('',names(PIK3CA_mutations_NR))
  
  Cell_lines_annotations_types_PIK3CA <- table(Cell_lines_annotations[names(PIK3CA_mutations_NR),]$type)
  Cell_lines_annotations_types_EGF <- table(Cell_lines_annotations[names(EGF_mutations_NR),]$type)
  
  sort(Cell_lines_annotations_types_PIK3CA/Cell_lines_annotations_types*100,decreasing = T)
  sort(Cell_lines_annotations_types_EGF/Cell_lines_annotations_types*100,decreasing = T)
  
  
  length(PIK3CA_mutations_NR) / (1457)
  length(EGF_mutations_NR) / (1457)
  PIK3CA_mutations[PIK3CA_mutations$Tumor.Sample.Barcode=='SF767_CENTRAL_NERVOUS_SYSTEM',]
  EGF_mutations[EGF_mutations$Tumor.Sample.Barcode=='SF767_CENTRAL_NERVOUS_SYSTEM',]
  
  AKT1seq <- read.table('/Users/weinhol/Promotion/DISSERTAION/PAPER/EGFR Paper/Review_BMC/broadinstitute_Mutations/mRNA expression (RNAseq)_ AKT1.txt',sep = '\t',header = T,fill=T)
  AKT1seq <- t(AKT1seq)
  AKT1seq <- (as.matrix(AKT1seq[-1,]))
  AKT1seqEXP <- as.double(AKT1seq[,1]); names(AKT1seqEXP) <- rownames(AKT1seq)
  PIK3CAseq <- read.table('/Users/weinhol/Promotion/DISSERTAION/PAPER/EGFR Paper/Review_BMC/broadinstitute_Mutations/mRNA expression (RNAseq)_ PIK3CA.txt',sep = '\t',header = T,fill=T)
  PIK3CAseq <- t(PIK3CAseq)
  PIK3CAseq <- (as.matrix(PIK3CAseq[-1,]))
  PIK3CAseqEXP <- as.double(PIK3CAseq[,1]); names(PIK3CAseqEXP) <- rownames(PIK3CAseq)
  
  CLCA2seq <- read.table('/Users/weinhol/Promotion/DISSERTAION/PAPER/EGFR Paper/Review_BMC/broadinstitute_Mutations/mRNA expression (RNAseq)_ CLCA2.txt',sep = '\t',header = T,fill=T)
  CLCA2seq <- t(CLCA2seq)
  CLCA2seq <- (as.matrix(CLCA2seq[-1,]))
  CLCA2seqEXP <- as.double(CLCA2seq[,1]); names(CLCA2seqEXP) <- rownames(CLCA2seq)
  
  seqEXP <- cbind("PIK3CA"=PIK3CAseqEXP,"AKT1"=AKT1seqEXP[names(PIK3CAseqEXP)],"CLCA2"=CLCA2seqEXP[names(PIK3CAseqEXP)])
  vennEXP <- f.input2(names(PIK3CA_mutations_NR),rownames(seqEXP))
  xG <- 'AKT1';yG <- 'PIK3CA'
  plot(seqEXP[vennEXP$inter,xG],seqEXP[vennEXP$inter,yG],pch=20,col='gray',xlab = xG,ylab=yG,xlim=c(3,8),ylim=c(0,7))
  points(seqEXP['SF767_CENTRAL_NERVOUS_SYSTEM',xG],seqEXP['SF767_CENTRAL_NERVOUS_SYSTEM',yG],pch=8,col=2)
  points(seqEXP['SKLMS1_SOFT_TISSUE',xG],seqEXP['SKLMS1_SOFT_TISSUE',yG],pch=9,col=3)
  points(seqEXP['MCF7_BREAST',xG],seqEXP['MCF7_BREAST',yG],pch=10,col=4)
  
  
 tmp <- CLCA2seqEXP[names(PIK3CAseqEXP)]
 tmp['SF767_CENTRAL_NERVOUS_SYSTEM']
 
  hist( seqEXP[,'CLCA2']);abline( v=c(seqEXP['SF767_CENTRAL_NERVOUS_SYSTEM','CLCA2'],seqEXP['LNZ308_CENTRAL_NERVOUS_SYSTEM','CLCA2']),col=2)
  table( seqEXP[,'CLCA2'] < seqEXP['SF767_CENTRAL_NERVOUS_SYSTEM','CLCA2'] ) 
  
  setdiff(gliomaCL,rownames(seqEXP))
  
  gliomaCL_CLCA2 <- seqEXP[c(intersect(rownames(seqEXP),gliomaCL),'SF767_CENTRAL_NERVOUS_SYSTEM'),'CLCA2'] 
  gliomaCL_CLCA2 <- sort(gliomaCL_CLCA2[!is.na(gliomaCL_CLCA2)])
  
  table( gliomaCL_CLCA2 <= gliomaCL_CLCA2['SF767_CENTRAL_NERVOUS_SYSTEM'] )
  
  table( seqEXP[,'CLCA2'] < 0 ) / sum( table( seqEXP[,'CLCA2'] < 0 ))
  
  seqEXP['SF767_CENTRAL_NERVOUS_SYSTEM',]
  seqEXP['LNZ308_CENTRAL_NERVOUS_SYSTEM',]
  seqEXP['SKLMS1_SOFT_TISSUE',]
  
  boxplot( seqEXP[,'CLCA2'])
  quantile( seqEXP[,'CLCA2'],na.rm = T,probs = .95)
  head(as.double(PIK3CAseq[-1,]))


}
# Pis = c(0.55,0.15,0.15,0.15)
Pis = c(0.7,0.1,0.1,0.1)
runPred <- function(set,pis){
  ### normalize Data ----------------------------------------------------------------------
  # normData <- normalizeExpData()
  # normData <- normalizeExpData(DetectionPvalNumber = 1)
  normData <- normalizeExpData(set = set)
  
  ### calulate logLik for class  Data ----------------------------------------------------------------------
  Lsets <- get.Lset()
  IndicatorVar <- lapply(Lsets,function(x){
    vec <- rep(0,6);names(vec) <- c(1:6)
    if (!is.null(x$s1)) { vec[x$s1] <- 1 }
    return(vec)
  })
  # pheatmap::pheatmap(t(do.call(rbind, IndicatorVar)),cluster_rows = F,cluster_cols = F)
  
  normDataLogLikData <- logLikelihoodOfnormData(normData$E)
  normDataLogLik <- normDataLogLikData[['logL']]
  ALL.MUs  <- normDataLogLikData[['ALL.MUs']]
  ALL.VARs <- normDataLogLikData[['ALL.VARs']]
  
  # TPRid = 'ILMN_1730999'
  # exp(normDataLogLik[TPRid,]) 
  
  ### calulate BIC from logLik  ----------------------------------------------------------------------
  npar <- sapply(Lsets, function(x) sum(!sapply(x,is.null ) )) + 1  ## number parapeters for LogLilk -> mean + var 
  k <-  sapply(Lsets, function(x) sum( sapply(x,length) ))
  normDataBIC <- get.IC(normDataLogLik , npar, k , IC = 'BIC')
  BICminInd <- apply( normDataBIC,MARGIN = 1, FUN = minIndex)
  print(table(BICminInd))
  
  # normDataBIC[TPRid,]
  # exp(normDataLogLik[TPRid,]) / ( sqrt(6)^npar )
  
  ### calulate Posterior from BIC ----------------------------------------------------------------------
  # normDataPosterior <- get.Posterior( normDataBIC ,Pis = c(0.7,0.1,0.1,0.1))
  normDataPosterior <- get.Posterior( normDataBIC ,Pis = pis)
  

  POSTmaxInd <- apply(normDataPosterior, MARGIN = 1 ,FUN = maxIndex)
  print(table(POSTmaxInd))
  
  PostClass <- get.gene.group(data = normDataPosterior,indexing = "maximal",filter = 0.75, DoPlot = TRUE)
  
  return(list("PostClass"=PostClass,'normData'=normData,'ALL.MUs'=ALL.MUs,'ALL.VARs'=ALL.VARs,'normDataPosterior'=normDataPosterior,'normDataBIC'=normDataBIC))
}

plotOUT <- '/Volumes/Macintosh HD/Users/weinhol/Promotion/ServerTMP/KapplerWichmann/PLOTS_SF767-1-799-6/'

SF767 <- runPred(set = 'SF767',pis= Pis)
MeanFoldChangeClass <- get.log2Mean.and.log2FC(normData = SF767$normData)
MeanFoldChangeClassSF767 <- get.log2Mean.and.log2FC(normData = SF767$normData)

qCPRdataC <- getQPCR(set = 'SF767')
qCPRdata767 <- getQPCR(set = 'SF767')
IDs.dt <- data.table::data.table(SF767$normData$genes,keep.rownames = T,key = 'rn')
IDs.dt.c <- IDs.dt[rownames(SF767$PostClass$resFilter$c),]
data.table::setkey(IDs.dt.c,'SYMBOL')
qgenesIDs <- lapply(qCPRdataC$rn, function(qg) as.character(IDs.dt.c[qg,][['rn']]) )
names(qgenesIDs) <- qCPRdataC$rn

### regulated !!! --> Pis = c(0.85,0.05,0.05,0.05) ????
table(SF767$normData$E[,2]-SF767$normData$E[,1]>0.5) / nrow(SF767$normData$E)
table(SF767$normData$E[,4]-SF767$normData$E[,3]>0.5) / nrow(SF767$normData$E)
table(SF767$normData$E[,6]-SF767$normData$E[,5]>0.5) / nrow(SF767$normData$E)


L799 <- runPred(set = 'L799',pis= Pis)
qCPRdata799 <- getQPCR(set = 'L799')
MeanFoldChangeClassL799 <- get.log2Mean.and.log2FC(normData = L799$normData)

### microarray EGF plot
SF767E12 <- SF767$normData$E[,c(1,2)]
L799E12 <- L799$normData$E[,c(1,2)]
SF767E12FC <- SF767E12[,2] - SF767E12[,1]
L799E12FC <- L799E12[,2] - L799E12[,1]

pdata <- rbind(
  data.frame("Gene"=names(qgenesIDs),
             "ID"=as.character(do.call(c,qgenesIDs)),
             "CellLine"='SKLMS1',
             "log2FC"=as.double(L799E12FC[do.call(c,qgenesIDs)])),
  data.frame("Gene"=names(qgenesIDs),
             "ID"=as.character(do.call(c,qgenesIDs)),
             "CellLine"='SF767',
             "log2FC"=as.double(SF767E12FC[do.call(c,qgenesIDs)]))
)
rns <- c('CKAP2L','ROCK1','TPR','ALDH4A1','CLCA2','GALNS'); pdata$Gene <- factor(pdata$Gene, levels = rns)
rns <- c("SF767","SKLMS1"); pdata$CellLine <- factor(pdata$CellLine, levels = rns)
cols <- RColorBrewer::brewer.pal(11,"PRGn")[c(3,9)]
# g1 <- ggplot(PlotDataFC,aes(x=factor(pid),y=FC,fill=factor(Set))) +
PlotFC <- ggplot(pdata,aes(x=factor(Gene),y=log2FC,fill=factor(CellLine)) )+ 
  geom_bar(position="dodge",stat="identity") + 
  ylim(c(-2.5 ,2.5)) +
  # labs(x = "", y = "Log2-fold change",title="Comparison of Illumina data and RT-qPCR") +
  labs(x = "", y = "Log2-fold change") +
  scale_fill_manual(values = cols,name="") + 
  thememapBarplot(base_size = base_size,legend_key_size = 0.6) + 
  theme(legend.position="bottom") 
print(PlotFC)        
ggsave(plot = PlotFC,filename = paste0(plotOUT,'microarray_log2FC__SF767_SKLMS1_clca2.pdf'),width = 10,height = 6)

PlotFC <- ggplot(pdata[which(pdata$Gene != 'CLCA2'),],aes(x=factor(Gene),y=log2FC,fill=factor(CellLine)) ) + 
  geom_bar(position="dodge",stat="identity") + 
  ylim(c(-2.5 ,2.5)) +
  # labs(x = "", y = "Log2-fold change",title="Comparison of Illumina data and RT-qPCR") +
  labs(x = "", y = "Log2-fold change") +
  scale_fill_manual(values = cols,name="") + 
  thememapBarplot(base_size = base_size,legend_key_size = 0.6) + 
  theme(legend.position="bottom")  
print(PlotFC)  
ggsave(plot = PlotFC,filename = paste0(plotOUT,'microarray_log2FC__SF767_SKLMS1.pdf'),width = 10,height = 6)
### microarray EGF plot



### regulated !!!
table(L799$normData$E[,2]-L799$normData$E[,1]>0.5) / nrow(L799$normData$E)
table(L799$normData$E[,4]-L799$normData$E[,3]>0.5) / nrow(L799$normData$E)
table(L799$normData$E[,6]-L799$normData$E[,5]>0.5) / nrow(L799$normData$E)


# VENN --------------------------------------------------------------------
  vennAres <- f.input2(rownames(L799$PostClass$res$a),rownames(SF767$PostClass$res$a),name = c('799','A \n\n 767'))
  vennBres <- f.input2(rownames(L799$PostClass$res$b),rownames(SF767$PostClass$res$b),name = c('799','B \n\n 767'))
  vennCres <- f.input2(rownames(L799$PostClass$res$c),rownames(SF767$PostClass$res$c),name = c('799','C \n\n 767'))
  vennDres <- f.input2(rownames(L799$PostClass$res$d),rownames(SF767$PostClass$res$d),name = c('799','D \n\n 767'))
  
  vennA <- f.input2(rownames(L799$PostClass$resFilter$a),rownames(SF767$PostClass$resFilter$a),name = c('799','A filter \n\n 767'))
  vennB <- f.input2(rownames(L799$PostClass$resFilter$b),rownames(SF767$PostClass$resFilter$b),name = c('799','B filter \n\n 767'))
  vennC <- f.input2(rownames(L799$PostClass$resFilter$c),rownames(SF767$PostClass$resFilter$c),name = c('799','C filter \n\n 767'))
  vennD <- f.input2(rownames(L799$PostClass$resFilter$d),rownames(SF767$PostClass$resFilter$d),name = c('799','D filter \n\n 767'))
  
  write.csv2(rownames(SF767$PostClass$resFilter$c),'SF767_PostClass_resFilter_c.csv')
  
  setkey(IDs.dt,'rn')
  ListCinter <- IDs.dt[vennC$inter,.(rn ,SYMBOL)]
  ListCinter <- merge(ListCinter, MeanFoldChangeClassSF767$c[,.(rn,s1M,s0M,s1s0FC)],by.x = 'rn',by.y = 'rn')
  colnames(ListCinter)[3:5] <- paste0("SF767_",colnames(ListCinter)[3:5])
  ListCinter$SF767_Postc <- SF767$PostClass$resFilter$c[vennC$inter,'c']
  ListCinter <- merge(ListCinter, MeanFoldChangeClass799$c[,.(rn,s1M,s0M,s1s0FC)],by.x = 'rn',by.y = 'rn')
  colnames(ListCinter)[7:9] <- paste0("L799",colnames(ListCinter)[3:5])
  ListCinter$L799_Postc <- L799$PostClass$resFilter$c[vennC$inter,'c']
  setkey(ListCinter,'rn')
  write.csv2(ListCinter,file = paste0(plotOUT,'SF767_L799_Intersect_Post_class_C75.csv') )
  
  pdf(paste0(plotOUT,'SF767_L799_Intersect_Post_class_C75_log2FC.pdf'),10,10)
    ListCinter[barplot(rbind(SF767_s1s0FC,L799SF767_s1s0FC),beside = T,names.arg = SYMBOL,legend.text = c('SF767','L79'),las=2,ylim = c(-1.5,1.5))]
    ListCinter[plot(SF767_Postc,L799_Postc)]
  dev.off()  
  
  ListCinter[c('ILMN_1758963', 'ILMN_1668090', 'ILMN_1711516', 'ILMN_2148360', 'ILMN_1767320'),]
  
  Density.NV.fit.plot(id = 'ILMN_2148360' ,SF767$normData, SF767$ALL.MUs, SF767$ALL.VARs, useGroup = 'c' ,DOplot = FALSE)
  Density.NV.fit.plot(id = 'ILMN_2148360' ,L799$normData, L799$ALL.MUs, L799$ALL.VARs, useGroup = 'c' ,DOplot = FALSE)
  GeneExample <- c(  'ILMN_2148360','ILMN_1718946', 'ILMN_1758963','ILMN_1711516','ILMN_1668090', 'ILMN_1767320')
  names(GeneExample) <- c('g1','g2','g3','g4','g5','g6')
  tmpPlot <- purrr::map2(GeneExample,c('c','a','c','c','c','c'),function(.x,.y) Density.NV.fit.plot(id = .x ,SF767$normData, SF767$ALL.MUs, SF767$ALL.VARs, useGroup = .y ,DOplot = FALSE) )
  grid.arrange( tmpPlot$g1 + theme(legend.position = "none"),
                tmpPlot$g2 + theme(legend.position = "none"),
                tmpPlot$g3 + theme(legend.position = "none"),
                tmpPlot$g4 + theme(legend.position = "none"),
                tmpPlot$g5 + theme(legend.position = "none") ,
                tmpPlot$g6 + theme(legend.position = "none") ,ncol = 2,nrow = 3,
                bottom = textGrob("The group having the minimum log-likelihood is highlighted with yellow.",gp = gpar(fontsize = 12,font = 1))
  )            
  
  tmpPlot <- purrr::map2(GeneExample,c('c','c','c','c','c','c'),function(.x,.y) Density.NV.fit.plot(id = .x ,L799$normData, L799$ALL.MUs, L799$ALL.VARs, useGroup = .y ,DOplot = FALSE) )
  grid.arrange( tmpPlot$g1 + theme(legend.position = "none"),
                tmpPlot$g2 + theme(legend.position = "none"),
                tmpPlot$g3 + theme(legend.position = "none"),
                tmpPlot$g4 + theme(legend.position = "none"),
                tmpPlot$g5 + theme(legend.position = "none") ,
                tmpPlot$g6 + theme(legend.position = "none") ,ncol = 2,nrow = 3,
                bottom = textGrob("The group having the minimum log-likelihood is highlighted with yellow.",gp = gpar(fontsize = 12,font = 1))
  )        
  
    
  SF767$normData$E[IDs.dt[IDs.dt$SYMBOL=="ADAM10",][['rn']],]
  L799$normData$E[IDs.dt[IDs.dt$SYMBOL=="ADAM10",][['rn']],]
  
  Density.NV.fit.plot(id = IDs.dt[IDs.dt$SYMBOL=="PTEN",][['rn']] ,SF767$normData, SF767$ALL.MUs, SF767$ALL.VARs ,DOplot = T)
  Density.NV.fit.plot(id = IDs.dt[IDs.dt$SYMBOL=="PTEN",][['rn']]  ,L799$normData, L799$ALL.MUs, L799$ALL.VARs,  ,DOplot = T)
  Density.NV.fit.plot(id = IDs.dt[IDs.dt$SYMBOL=="PIK3CD",][['rn']] ,SF767$normData, SF767$ALL.MUs, SF767$ALL.VARs  ,DOplot = T)
  Density.NV.fit.plot(id = IDs.dt[IDs.dt$SYMBOL=="PIK3CD",][['rn']]  ,L799$normData, L799$ALL.MUs, L799$ALL.VARs,  ,DOplot = T)
  SF767$normData$E[IDs.dt[IDs.dt$SYMBOL=="PTEN",][['rn']],]
  L799$normData$E[IDs.dt[IDs.dt$SYMBOL=="PTEN",][['rn']],]
  SF767$normData$E[IDs.dt[IDs.dt$SYMBOL=="PIK3CD",][['rn']],]
  L799$normData$E[IDs.dt[IDs.dt$SYMBOL=="PIK3CD",][['rn']],]
  
  SF767$normData$E[IDs.dt[IDs.dt$SYMBOL=="S1PR3",][['rn']],]
  L799$normData$E[IDs.dt[IDs.dt$SYMBOL=="S1PR3",][['rn']],]
  
  SF767$normData$E[IDs.dt[IDs.dt$SYMBOL=="ADAM17",][['rn']],]
  L799$normData$E[IDs.dt[IDs.dt$SYMBOL=="ADAM17",][['rn']],]
  
  PAM50gene_namesIDstab <-  IDs.dt[IDs.dt$SYMBOL %in% PAM50gene_names,]
  PAM50gene_namesIDs <- PAM50gene_namesIDstab[['rn']]
  names(PAM50gene_namesIDs) <- as.character(paste0("g",1:length(PAM50gene_namesIDs)))
  tmpPlot <- purrr::map(PAM50gene_namesIDs,function(.x) Density.NV.fit.plot(id = .x ,SF767$normData, SF767$ALL.MUs, SF767$ALL.VARs,DOplot = FALSE) )
  pdf(paste0(plotOUT,'s.pdf'),width = 12,height = 8)
  f.input3(PAM50gene_namesIDstab$rn,rownames(SF767$PostClass$resFilter$c),rownames(SF767$PostClass$res$c),c('PAM50','resfilter','res'))
  for(i in names(tmpPlot)){
    plot(tmpPlot[[i]])
  }
  dev.off()

  PANTHER_PATHWAY_P00018_EGFR <- c("ILMN_2166093", "ILMN_2388507", "ILMN_1674385", "ILMN_1805853", "ILMN_1687896", "ILMN_1777325", "ILMN_1801383", "ILMN_2181968", "ILMN_1767320", "ILMN_1719792")
  names(PANTHER_PATHWAY_P00018_EGFR) <- as.character(paste0("g",1:length(PANTHER_PATHWAY_P00018_EGFR)))
  tmpPlot <- purrr::map(PANTHER_PATHWAY_P00018_EGFR,function(.x) Density.NV.fit.plot(id = .x ,SF767$normData, SF767$ALL.MUs, SF767$ALL.VARs,DOplot = FALSE) )
  pdf(paste0(plotOUT,'PANTHER_PATHWAY_P00018_EGFR.pdf'),width = 12,height = 8)
  f.input3(PANTHER_PATHWAY_P00018_EGFR,rownames(SF767$PostClass$resFilter$c),rownames(SF767$PostClass$res$c),c('Panther','resfilter','res'))
  f.input3(PANTHER_PATHWAY_P00018_EGFR,rownames(SF767$PostClass$resFilter$c),rownames(L799$PostClass$res$c),c('Panther','resfilter','resfilter799'))
  
  for(i in names(tmpPlot)){
    plot(tmpPlot[[i]])
  }
  dev.off()
  
  # ILMN_1739645 −− ANLN [This gene encodes an actin-binding protein that plays a role in cell growth and migration, and in cytokinesis.]
  SF767$normData$E[IDs.dt[IDs.dt$SYMBOL=="ANLN",][['rn']],]
  L799$normData$E[IDs.dt[IDs.dt$SYMBOL=="ANLN",][['rn']],]
  Density.NV.fit.plot(id = IDs.dt[IDs.dt$SYMBOL=="ANLN",][['rn']] ,SF767$normData, SF767$ALL.MUs, SF767$ALL.VARs ,DOplot = T)
  Density.NV.fit.plot(id = IDs.dt[IDs.dt$SYMBOL=="ANLN",][['rn']]  ,L799$normData, L799$ALL.MUs, L799$ALL.VARs,  ,DOplot = T)
  
  tmpS <- 'STAT5A'
  tmpS <- 'OGDH'
  tmpS <- 'CCND1'
  tmpS <- 'BIRC5' #Survivin
  tmpS <- 'MMP2' 
  tmpS <- 'CKAP2'
  tmpS <- 'ARSB'
  tmpS <- "PTPN11" #'SHP2'
  tmpS <- "CBL" #'SHP2'
  tmpS <- "MAPK1" #'SHP2'
  
  SF767$normData$E[IDs.dt[IDs.dt$SYMBOL==tmpS,][['rn']],]
  SF767$normDataBIC[IDs.dt[IDs.dt$SYMBOL==tmpS,][['rn']],]
  SF767$normDataPosterior[IDs.dt[IDs.dt$SYMBOL==tmpS,][['rn']],]
  MeanFoldChangeClass767$c[IDs.dt[IDs.dt$SYMBOL==tmpS,][['rn']],]
  
  L799$normData$E[intersect(rownames(L799$normData$E),IDs.dt[IDs.dt$SYMBOL==tmpS,][['rn']]),]
  L799$normDataPosterior[intersect(rownames(L799$normData$E),IDs.dt[IDs.dt$SYMBOL==tmpS,][['rn']]),]
  Density.NV.fit.plot(id = IDs.dt[IDs.dt$SYMBOL==tmpS,][['rn']][2] ,SF767$normData, SF767$ALL.MUs, SF767$ALL.VARs ,DOplot = T)
  Density.NV.fit.plot(id = IDs.dt[IDs.dt$SYMBOL==tmpS,][['rn']][3]  ,L799$normData, L799$ALL.MUs, L799$ALL.VARs,  ,DOplot = T)
  
  ggsave(plot = tmpPlot,filename = paste0(plotOUT,'s.pdf'),width = 12,height = 8)
    
  f.input5(rownames(SF767$PostClass$resFilter$c),
           rownames(L799$PostClass$res$a),
           rownames(L799$PostClass$res$b),
           rownames(L799$PostClass$res$c),
           rownames(L799$PostClass$res$d),
           name = c('C filter \n\n 767','a','b','c','d')
  )
  
  f.input5(do.call(c,qgenesIDs),
           rownames(L799$PostClass$res$a),
           rownames(L799$PostClass$res$b),
           rownames(L799$PostClass$res$c),
           rownames(L799$PostClass$res$d),
           name = c('C filter \n\n 767','a','b','c','d')
  )
  do.call(c,qgenesIDs)
  L799$PostClass$res$a[intersect(do.call(c,qgenesIDs),rownames(L799$PostClass$res$a)),]
  L799$PostClass$res$b[intersect(do.call(c,qgenesIDs),rownames(L799$PostClass$res$b)),]
  L799$PostClass$res$c[intersect(do.call(c,qgenesIDs),rownames(L799$PostClass$res$c)),]
  L799$PostClass$res$d[intersect(do.call(c,qgenesIDs),rownames(L799$PostClass$res$d)),]
  
  L799$normDataPosterior[intersect(do.call(c,qgenesIDs),rownames(L799$normDataPosterior)),]
  L799$ALL.MUs[intersect(do.call(c,qgenesIDs),rownames(L799$ALL.MUs)),]
  
  # round(get.Posterior( L799$normDataBIC[intersect(do.call(c,qgenesIDs),rownames(L799$normDataBIC)),] ,Pis = c(0.7,0.1,0.1,0.1)),2)
  # round(get.Posterior( SF767$normDataBIC[intersect(do.call(c,qgenesIDs),rownames(SF767$normDataBIC)),] ,Pis = c(0.7,0.1,0.1,0.1)),2)
  # round(get.Posterior( L799$normDataBIC[intersect(do.call(c,qgenesIDs),rownames(L799$normDataBIC)),] ,Pis = c(0.55,0.15,0.15,0.15)),2)
  # round(get.Posterior( SF767$normDataBIC[intersect(do.call(c,qgenesIDs),rownames(SF767$normDataBIC)),] ,Pis = c(0.55,0.15,0.15,0.15)),2)


# normdata ALL ------------------------------------------------------------
  normData767 <- normalizeExpData(DetectionPvalNumber = 0)
  MeanFoldChangeClass767 <- get.log2Mean.and.log2FC(normData = normData767)
  qCPRdata767 <- getQPCR()
  
  normData799 <- normalizeExpData(set = 'L799',DetectionPvalNumber = 0)
  MeanFoldChangeClass799 <- get.log2Mean.and.log2FC(normData = normData799)
  qCPRdata799 <- getQPCR(set = 'L799')
  
  tmpQPCR <- merge( qCPRdata767[,.(rn,`relative.Werte.geoMean.C1C0.logFC`)] , qCPRdata799[,.(rn,`relative.Werte.geoMean.C1C0.logFC`)],by.x='rn',by.y = 'rn',sub=c('_767','_799') )
  colnames(tmpQPCR) <- c('rn','SF767','L799')
  setkey(tmpQPCR,'rn')
  barplot(t(cbind(tmpQPCR$SF767,tmpQPCR$L799)),beside = T,names.arg = tmpQPCR$rn,legend.text = c('SF767','L799'),main='qPCR',ylab='log2FC')
   
  setkey(IDs.dt,'rn')
  barplot(t(cbind(MeanFoldChangeClass767$c[vennC$inter,]$s1s0FC,MeanFoldChangeClass799$c[vennC$inter,]$s1s0FC)),beside = T,names.arg = IDs.dt[vennC$inter,]$SYMBOL,legend.text = c('SF767','L799'),main='Sig C in both',ylab='log2FC',las=2)
  cor(cbind(MeanFoldChangeClass767$c[vennC$inter,]$s1s0FC,MeanFoldChangeClass799$c[vennC$inter,]$s1s0FC))
  
  # HOT:'ADAM10','STAM2'
  # may: "LARP7",'STK25'
  
  
  # cor(cbind(MeanFoldChangeClass767$a[vennA$inter,]$s1s0FC,MeanFoldChangeClass799$a[vennA$inter,]$s1s0FC))
  barplot(t(cbind(MeanFoldChangeClass767$b[vennB$inter,]$s1s0FC,MeanFoldChangeClass799$b[vennB$inter,]$s1s0FC)),beside = T,names.arg = IDs.dt[vennB$inter,]$SYMBOL,legend.text = c('SF767','L799'),main='Sig B in both',ylab='log2FC',las=2)
  cor(cbind(MeanFoldChangeClass767$b[vennB$inter,]$s1s0FC,MeanFoldChangeClass799$b[vennB$inter,]$s1s0FC))
  barplot(t(cbind(MeanFoldChangeClass767$d[vennD$inter,]$s1s0FC,MeanFoldChangeClass799$d[vennD$inter,]$s1s0FC)),beside = T,names.arg = IDs.dt[vennD$inter,]$SYMBOL,legend.text = c('SF767','L799'),main='Sig D in both',ylab='log2FC',las=2)
  cor(cbind(MeanFoldChangeClass767$d[vennD$inter,]$s1s0FC,MeanFoldChangeClass799$d[vennD$inter,]$s1s0FC))



# barplot SF767 vs 799 - Illumina data and RT-qPCR ------------------------
  
  data.table::setkey(IDs.dt,'SYMBOL')
  
  cols <- RColorBrewer::brewer.pal(11,"PRGn")[c(3,9)]
  dodge <- position_dodge(width=0.9)
  base_size <- 20
  
  # qgenesIDs767 <- lapply(qCPRdata767$rn, function(qg) as.character(IDs.dt[qg,][['rn']]) )
  # names(qgenesIDs767) <- qCPRdata767$rn
  PlotDataFC767 <- make.plot.data.FC.Ill.qPCR(qCPRdata = qCPRdata767, qgenesIDs = qgenesIDs, MeanFoldChangeClass767, class="c" )
  limits <- aes(ymax = PlotDataFC767$FC + PlotDataFC767$stderr , ymin=PlotDataFC767$FC - PlotDataFC767$stderr)
  
  rns <- levels(PlotDataFC767$Gene)[c(2,5,6,1,3,4)] ; PlotDataFC767$Gene <- factor(PlotDataFC767$Gene, levels = rns)
  rns <- levels(PlotDataFC767$pid)[c(2,5,6,1,3,4)]  ; PlotDataFC767$pid <- factor(PlotDataFC767$pid, levels = rns)
  
  PlotFC767 <- ggplot(PlotDataFC767,aes(x=factor(Gene),y=FC,fill=factor(Set))) +  
    geom_bar(position="dodge",stat="identity") + 
    geom_errorbar(limits, position=dodge, width=0.4) +
    ylim(c(-4 ,4)) +
    labs(x = "", y = "Log2-fold change",title="PAPER PLOT - Comparison of SF767 - Illumina data and RT-qPCR") +
    # labs(x = "", y = "Log2-fold change") +
    scale_fill_manual(values = cols,name="") + 
    thememapBarplot(base_size = base_size,legend_key_size = 0.6) + 
    # theme( aspect.ratio = 9 / 16) + 
    theme(legend.position="bottom") 
  print(PlotFC767)
  ggsave(plot = PlotFC767,filename = paste0(plotOUT,'SF767__Array_qPCR__paperPlot.pdf'),width = 12,height = 8)
  
  class <- 'c'
  qgenesIDs799 <- lapply(qCPRdata799$rn, function(qg) as.character(IDs.dt[qg,][['rn']]) )
  names(qgenesIDs799) <- qCPRdata799$rn
  PlotDataFC799 <- make.plot.data.FC.Ill.qPCR(qCPRdata = qCPRdata799, qgenesIDs = qgenesIDs, MeanFoldChangeClass799, class=class )
  
  rns <- levels(PlotDataFC799$Gene)[c(2,5,6,1,3,4)] ; PlotDataFC799$Gene <- factor(PlotDataFC799$Gene, levels = rns)
  rns <- levels(PlotDataFC799$pid)[c(2,5,6,1,3,4)]  ; PlotDataFC799$pid <- factor(PlotDataFC799$pid, levels = rns)
  limits <- aes(ymax = PlotDataFC799$FC + PlotDataFC799$stderr , ymin=PlotDataFC799$FC - PlotDataFC799$stderr)
  PlotFC799 <- ggplot(PlotDataFC799,aes(x=factor(Gene),y=FC,fill=factor(Set))) +  
    geom_bar(position="dodge",stat="identity") + 
    geom_errorbar(limits, position=dodge, width=0.4) +
    ylim(c(-4 ,4)) +
    labs(x = "", y = paste0("Log2-fold change of class ",class),title="Comparison of 799 data - Illumina data and RT-qPCR") +
    # labs(x = "", y = "Log2-fold change") +
    scale_fill_manual(values = cols,name="") + 
    thememapBarplot(base_size = base_size,legend_key_size = 0.6) + 
    # theme( aspect.ratio = 9 / 16) + 
    theme(legend.position="bottom") 
  print(PlotFC799)
  ggsave(plot = PlotFC799,filename = paste0(plotOUT,'L799__Array_qPCR.pdf'),width = 12,height = 8)
  
  
  PlotDataFC799$Line <- 'L799'
  PlotDataFC767$Line <- 'SF767'
  
  pdata <- rbind(PlotDataFC799,PlotDataFC767)
  pdata$Set2 <- paste0(pdata$Line,'_',pdata$Set)
  cols2 <- RColorBrewer::brewer.pal(11,"PRGn")[c(5,4,8,9)]
  
  rns <- levels(pdata$Gene)[c(2,5,6,1,3,4)] ; pdata$Gene <- factor(pdata$Gene, levels = rns)
  rns <- levels(pdata$pid)[c(2,5,6,1,3,4)]  ; pdata$pid <- factor(pdata$pid, levels = rns)
  limits <- aes(ymax = pdata$FC + pdata$stderr , ymin=pdata$FC - pdata$stderr)
  Plot_pdata <- ggplot(pdata,aes(x=factor(Gene),y=FC,fill=factor(Set2))) +  
    geom_bar(position="dodge",stat="identity") + 
    geom_errorbar(limits, position=dodge, width=0.4) +
    ylim(c(-4 ,4)) +
    labs(x = "", y = paste0("Log2-fold change of class ",class),title="SF767 vs 799 - Illumina data and RT-qPCR") +
    # labs(x = "", y = "Log2-fold change") +
    scale_fill_manual(values = cols2,name="") + 
    thememapBarplot(base_size = base_size,legend_key_size = 0.6) + 
    # theme( aspect.ratio = 9 / 16) + 
    theme(legend.position="bottom")
  print(Plot_pdata)
  ggsave(plot = Plot_pdata,filename = paste0(plotOUT,'SF767_L799__Array_qPCR.pdf'),width = 12,height = 8)
  
  
  pdataqPCR <- pdata[pdata$Set != 'Microarray',]
  rns <- levels(pdataqPCR$Gene)[c(2,5,6,1,3,4)] ; pdataqPCR$Gene <- factor(pdataqPCR$Gene, levels = rns)
  rns <- levels(pdataqPCR$pid)[c(2,5,6,1,3,4)]  ; pdataqPCR$pid <- factor(pdataqPCR$pid, levels = rns)
  limits <- aes(ymax = pdataqPCR$FC + pdataqPCR$stderr , ymin=pdataqPCR$FC - pdataqPCR$stderr)
  Plot_pdata <- ggplot(pdataqPCR,aes(x=factor(Gene),y=FC,fill=factor(Set2))) +  
    geom_bar(position="dodge",stat="identity") + 
    geom_errorbar(limits, position=dodge, width=0.4) +
    ylim(c(-4 ,4)) +
    labs(x = "", y = paste0("Log2-fold change of class ",class),title="SF767 vs 799 - RT-qPCR") +
    scale_fill_manual(values = cols2[c(2,4)],name="") + 
    thememapBarplot(base_size = base_size,legend_key_size = 0.6) + 
    theme(legend.position="bottom")
  print(Plot_pdata)
  ggsave(plot = Plot_pdata,filename = paste0(plotOUT,'SF767_L799__qPCR.pdf'),width = 12,height = 8)
  
  FindBest799plot <- function(){
    
    pdataqPCRscatter <- pdataqPCR[which(pdataqPCR$Set2 == 'L799_qPCR'),c("Gene","ExpID","FC","stderr")]
    names(pdataqPCRscatter)[c(3,4)] <- c( 'FC_L799_qPCR','stderr_L799_qPCR')
    pdataqPCRscatter <- cbind(pdataqPCRscatter, pdataqPCR[which(pdataqPCR$Set2 == 'SF767_qPCR'),c("FC","stderr")])
    names(pdataqPCRscatter)[c(5,6)] <- c( 'FC_SF767_qPCR','stderr_SF767_qPCR')
    Plot_pdata <- ggplot(pdataqPCRscatter,aes(x=FC_SF767_qPCR,y=FC_L799_qPCR)) +
      geom_point() +
      ylim(c(-2 ,2)) + xlim(c(-2 ,2)) +
      geom_text(label=pdataqPCRscatter$Gene, hjust = 0, nudge_x = 0.05) +
      labs(title="Scatter plot of log2 foldchanges", x='FC_SF767_qPCR', y = 'FC_L799_qPCR') +
      geom_abline(intercept = 0, slope = 1, color="gray", linetype="dashed", size=0.3)
    print(Plot_pdata)
    ggsave(plot = Plot_pdata,filename = paste0(plotOUT,'SF767_L799__qPCR_scatterFC.pdf'),width = 6,height = 6)
  
    relExp <- melt(qCPRdata767[,c('rn',as.character(1:6))])
    relExp$Set2 <- 'SF767_qPCR'
    tmp <- melt(qCPRdata799[,c('rn',as.character(1:6))])
    tmp$Set2 <- 'L799_qPCR'
    pdataRelEx <- rbind(relExp,tmp)
    # limits <- aes(ymax = pdataqPCR$FC + pdataqPCR$stderr , ymin=pdataqPCR$FC - pdataqPCR$stderr)
    Plot_pdata <- ggplot(pdataRelEx,aes(x=factor(variable),y=value,fill=factor(Set2))) +  
      geom_bar(position="dodge",stat="identity") + 
      facet_grid(rn ~ .) +
      scale_fill_manual(values = cols2[c(2,4)],name="") + 
      labs(x = "experiment", y = paste0("relative expression qPCR"),title="SF767 vs 799 - RT-qPCR") +
      thememapBarplot(base_size = base_size,legend_key_size = 0.6) + theme(legend.position="bottom")
    print(Plot_pdata)
    ggsave(plot = Plot_pdata,filename = paste0(plotOUT,'SF767_L799__qPCR_relExp_Bar.pdf'),width = 10,height = 16)
    
    Plot_pdata <- ggplot(pdataRelEx,aes(value,fill=Set2) ) +  
      geom_density(alpha=.5) + facet_grid(rn ~ .) +
      scale_fill_manual(values = cols2[c(2,4)],name="") + 
      # scale_fill_manual(values = c('#999999','#E69F00')) + 
      thememapBarplot(base_size = base_size,legend_key_size = 0.6) + theme(legend.position="bottom") +
      labs( x = paste0("relative expression qPCR"),title="SF767 vs 799 - RT-qPCR") 
    print(Plot_pdata)
    ggsave(plot = Plot_pdata,filename = paste0(plotOUT,'SF767_L799__qPCR_relExp_Dens.pdf'),width = 10,height = 10)
    
    tmp1 <- pdataRelEx[which(pdataRelEx$Set2 == 'L799_qPCR'),c("rn","variable","value")]
    names(tmp1)[c(3)] <- c( 'L799')
    tmp2 <- pdataRelEx[which(pdataRelEx$Set2 == 'SF767_qPCR'),c("rn","variable","value")]
    names(tmp2)[c(3)] <- c( 'SF767')
    pdataRelExScatter <- cbind(tmp1,tmp2[,'SF767'])
    Plot_pdata <- ggplot(pdataRelExScatter,aes(x=SF767,y=L799, color=as.character(variable))) +
      geom_point(size=2) +
      ylim(c(-3 ,10)) + xlim(c(-3 ,10)) +
      facet_wrap(~rn , nrow=3) +
      # geom_smooth(method=lm,fullrange=TRUE,se=FALSE)+
      thememapBarplot(base_size = base_size,legend_key_size = 0.6) + theme(legend.position="bottom") +
      # geom_text(label=pdataqPCRscatter$Gene, hjust = 0, nudge_x = 0.05) +
      # labs(title="Scatter plot of log2 foldchanges", x='FC_SF767_qPCR', y = 'FC_L799_qPCR') +
      geom_abline(intercept = 0, slope = 1, color="gray", linetype="dashed", size=0.3)
    print(Plot_pdata)
    ggsave(plot = Plot_pdata,filename = paste0(plotOUT,'SF767_L799__qPCR_relExp_ScatterLog2.pdf'),width = 14,height = 10)
    
    range(2^pdataRelExScatter$L799)
    
    Plot_pdata <-  ggplot(pdataRelExScatter,aes(x=2^SF767,y=2^L799, color=as.character(variable))) +
      ylim(c(0 ,750)) + xlim(c(0 ,250)) + geom_abline(intercept = 0, slope = 1, color="gray", linetype="dashed", size=0.3) +
      geom_point(size=2) +facet_wrap(~rn , nrow=3) +
      thememapBarplot(base_size = base_size,legend_key_size = 0.6) + theme(legend.position="bottom") 
    print(Plot_pdata)
    ggsave(plot = Plot_pdata,filename = paste0(plotOUT,'SF767_L799__qPCR_relExp_Scatter.pdf'),width = 14,height = 10)
    
    #### TODOD
    qCPRdata767exp <- getQPCR(set = 'SF767',expressionOut = TRUE)
    qCPRdata799exp <- getQPCR(set = 'L799',expressionOut = TRUE)
    
    pDataExp2 <- rbind(data.frame("Gene"= rownames(qCPRdata767exp[[1]]) ,"exp"=qCPRdata767exp[[1]][,c(1)],"stderr"=qCPRdata767exp[[2]][,c(1)],'Set2'='SF767_1'),
          data.frame("Gene"= rownames(qCPRdata767exp[[1]]) ,"exp"=qCPRdata767exp[[1]][,c(2)],"stderr"=qCPRdata767exp[[2]][,c(2)],'Set2'='SF767_2'),
          data.frame("Gene"= rownames(qCPRdata767exp[[1]]) ,"exp"=qCPRdata799exp[[1]][,c(1)],"stderr"=qCPRdata799exp[[2]][,c(1)],'Set2'='L799_1'),
          data.frame("Gene"= rownames(qCPRdata767exp[[1]]) ,"exp"=qCPRdata799exp[[1]][,c(2)],"stderr"=qCPRdata799exp[[2]][,c(2)],'Set2'='L799_2'))
    limits <- aes(ymax = pDataExp2$exp + pDataExp2$stderr , ymin=pDataExp2$exp - pDataExp2$stderr)
    Plot_pdata <- ggplot(pDataExp2,aes(x=factor(Gene),y=exp,fill=factor(Set2))) +  
      geom_bar(position="dodge",stat="identity") + 
      geom_errorbar(limits, position=dodge, width=0.4) +
      ylim(c(-5 ,10)) +
      labs(x = "", y = paste0("Log2-fold change of class ",class),title="SF767 vs 799 - Illumina data and RT-qPCR") +
      # labs(x = "", y = "Log2-fold change") +
      scale_fill_manual(values = cols2,name="") + 
      thememapBarplot(base_size = base_size,legend_key_size = 0.6) + 
      # theme( aspect.ratio = 9 / 16) + 
      theme(legend.position="bottom")
    print(Plot_pdata)
    
    tmp767 <- qCPRdata767[,c('rn',as.character(1:6))]
    tmp767_FC21 <- tmp767[['2']] - tmp767[['1']]
    tmp767_FC43 <- tmp767[['4']] - tmp767[['3']]
    tmp767_FC65 <- tmp767[['6']] - tmp767[['5']]
    names(tmp767_FC21) <- names(tmp767_FC43) <- names(tmp767_FC65) <- as.character(tmp767[['rn']])
    tmp799 <- qCPRdata799[,c('rn',as.character(1:6))]
    tmp799_FC21 <- tmp799[['2']] - tmp799[['1']]
    names(tmp799_FC21) <- as.character(tmp799[['rn']])
    
    
    tmpbar <- rbind(tmp799_FC21,tmp767_FC21)
    tmpbar <- tmpbar[,c(4,1,5,6,2,3)]
    pdf(paste0(plotOUT,'SF767_L799__qPCR_FC_of_[Ko+EGF]vs[Ko-EGF].pdf'),width = 10,height = 8)
      barplot(tmpbar,beside = T, ylim=c(-4 ,4),ylab="Log2-fold change of [Ko+EGF] - [Ko-EGF]",main="SF767 vs 799 - qPCR",col = cols2[c(2,4)],legend.text = c('L799','SF767'))
    dev.off()
    
    ### micro barplot
    SF767E12 <- SF767$normData$E[,c(1,2)]
    L799E12 <- L799$normData$E[,c(1,2)]
    geneSet12 <- f.input2(rownames(SF767E12),rownames(L799E12))
    geneSet12_qgenesIDs <-  f.input3(rownames(SF767E12),rownames(L799E12), do.call(c,qgenesIDs)) 
    SF767E12 <- SF767E12[geneSet12$inter,]
    L799E12 <- L799E12[geneSet12$inter,]
    SF767E12FC <- SF767E12[,2] - SF767E12[,1]
    L799E12FC <- L799E12[,2] - L799E12[,1]
    plot(SF767E12FC,L799E12FC)
    qgenesIDCOR <- cor(SF767E12FC[geneSet12_qgenesIDs],L799E12FC[geneSet12_qgenesIDs])#,method = 'spearman')
    barplot(rbind(SF767E12FC[geneSet12_qgenesIDs],L799E12FC[geneSet12_qgenesIDs]),beside = T)
    cor.test(SF767E12FC[geneSet12_qgenesIDs],L799E12FC[geneSet12_qgenesIDs],alternative = 'greater')
    CorSample <- sapply(1:5000,function(x){
      setx <- geneSet12$inter[sample( 1:length(geneSet12$inter),5)]
      cor(SF767E12FC[setx],L799E12FC[setx])#,method = 'spearman')
    } )
    boxplot(CorSample);abline(h=qgenesIDCOR,col=2)  
    CorQuant <- quantile(CorSample, probs = seq(0, 1, 0.05))
    CorQuant>qgenesIDCOR
    plot(density(CorSample));abline(v=qgenesIDCOR,col=2)  
    table(CorSample>qgenesIDCOR)/5000
   
    SF767E12 <- SF767$normData$E[,c(1,2)]
    L799E12 <- L799$normData$E[,c(1,2)]
    SF767E12FC <- SF767E12[,2] - SF767E12[,1]
    L799E12FC <- L799E12[,2] - L799E12[,1]
    
    pdata <- rbind(
              data.frame("Gene"=names(qgenesIDs),
               "ID"=as.character(do.call(c,qgenesIDs)),
               "CellLine"='SKLMS1',
               "log2FC"=as.double(L799E12FC[do.call(c,qgenesIDs)])),
              data.frame("Gene"=names(qgenesIDs),
               "ID"=as.character(do.call(c,qgenesIDs)),
               "CellLine"='SF767',
               "log2FC"=as.double(SF767E12FC[do.call(c,qgenesIDs)]))
    )
    rns <- c('CKAP2L','ROCK1','TPR','ALDH4A1','CLCA2','GALNS'); pdata$Gene <- factor(pdata$Gene, levels = rns)
    rns <- c("SF767","SKLMS1"); pdata$CellLine <- factor(pdata$CellLine, levels = rns)
    cols <- RColorBrewer::brewer.pal(11,"PRGn")[c(3,9)]
    # g1 <- ggplot(PlotDataFC,aes(x=factor(pid),y=FC,fill=factor(Set))) +
    PlotFC <- ggplot(pdata,aes(x=factor(Gene),y=log2FC,fill=factor(CellLine)) )+ 
      geom_bar(position="dodge",stat="identity") + 
      ylim(c(-2.5 ,2.5)) +
      # labs(x = "", y = "Log2-fold change",title="Comparison of Illumina data and RT-qPCR") +
      labs(x = "", y = "Log2-fold change") +
      scale_fill_manual(values = cols,name="") + 
      thememapBarplot(base_size = base_size,legend_key_size = 0.6) + 
      theme(legend.position="bottom") 
    print(PlotFC)        
    ggsave(plot = PlotFC,filename = paste0(plotOUT,'microarray_log2FC__SF767_SKLMS1_clca2.pdf'),width = 10,height = 6)
    
    PlotFC <- ggplot(pdata[which(pdata$Gene != 'CLCA2'),],aes(x=factor(Gene),y=log2FC,fill=factor(CellLine)) ) + 
     geom_bar(position="dodge",stat="identity") + 
     ylim(c(-2.5 ,2.5)) +
     # labs(x = "", y = "Log2-fold change",title="Comparison of Illumina data and RT-qPCR") +
     labs(x = "", y = "Log2-fold change") +
     scale_fill_manual(values = cols,name="") + 
     thememapBarplot(base_size = base_size,legend_key_size = 0.6) + 
     theme(legend.position="bottom")  
    print(PlotFC)  
    ggsave(plot = PlotFC,filename = paste0(plotOUT,'microarray_log2FC__SF767_SKLMS1.pdf'),width = 10,height = 6)
    

    pdataqMicro12 <- pdataqPCR
    pdataqMicro12$Set2 <- c(rep('L799',6),rep('SF767',6)) 
    pdataqMicro12$Set <- 'Microarray'
    pdataqMicro12$FC <- c(L799E12FC[as.character(pdataqMicro12[pdataqMicro12$Set2=='L799',]$ExpID)],SF767E12FC[as.character(pdataqMicro12[pdataqMicro12$Set2=='SF767',]$ExpID)])
    pdataqMicro12$stderr <- NULL
    rns <- levels(pdataqMicro12$Gene)[c(2,5,6,1,3,4)] ; pdataqMicro12$Gene <- factor(pdataqMicro12$Gene, levels = rns)
    rns <- levels(pdataqMicro12$pid)[c(2,5,6,1,3,4)]  ; pdataqMicro12$pid <- factor(pdataqMicro12$pid, levels = rns)
    # limits <- aes(ymax = pdataqPCR$FC + pdataqPCR$stderr , ymin=pdataqPCR$FC - pdataqPCR$stderr)
    Plot_pdata <- ggplot(pdataqMicro12,aes(x=factor(Gene),y=FC,fill=factor(Set2))) +  
      geom_bar(position="dodge",stat="identity") + 
      # geom_errorbar(limits, position=dodge, width=0.4) +
      ylim(c(-4 ,4)) +
      labs(x = "", y = paste0("Log2-fold change of [Ko+EGF] - [Ko-EGF]"),title="SF767 vs 799 - Microarray") +
      scale_fill_manual(values = cols2[c(2,4)],name="") + 
      thememapBarplot(base_size = base_size,legend_key_size = 0.6) + 
      theme(legend.position="bottom")
    print(Plot_pdata)
    
    ### Answer review B.5
    ggsave(plot = Plot_pdata,filename = paste0(plotOUT,'SF767_L799__Microarray_FC_of_[Ko+EGF]vs[Ko-EGF].pdf'),width = 10,height = 8)
    
    
    
    # # y2s0 = c('K_1','K_2','K_3'),s1 = c('K_EGF_1','K_EGF_2','K_EGF_3')
    # y3FC_K <- getS1S0log2FC(y3,s0 = c('K_1','K_2','K_3'),s1 = c('K_EGF_1','K_EGF_2','K_EGF_3') )
    # setkey(y3FC_K,'rn')
    # SF767E12 <- SF767$normData$E[,c(1,2)]
    # y3geneSet12 <- f.input2(rownames(SF767E12),y3FC_K[['rn']])
    # y3geneSet12_qgenesIDs <-  f.input3(rownames(SF767E12),y3FC_K[['rn']], do.call(c,qgenesIDs)) 
    # y3FC_K <- y3FC_K[y3geneSet12$inter,]
    # y3FC_K_FC <- y3FC_K[['s1s0FC']];names(y3FC_K_FC) <- y3FC_K[['rn']]
    # SF767E12 <- SF767E12[y3geneSet12$inter,]
    # SF767E12FC <- SF767E12[,2] - SF767E12[,1]
    # plot(SF767E12FC,y3FC_K_FC);
    # cor(SF767E12FC,y3FC_K_FC);
    # qgenesIDCOR <- cor(SF767E12FC[geneSet12_qgenesIDs],y3FC_K_FC[geneSet12_qgenesIDs])#,method = 'spearman')
    # CorSample <- sapply(1:1000,function(x){
    #   setx <- y3geneSet12$inter[sample( 1:length(y3geneSet12$inter),5)]
    #   cor(SF767E12FC[setx],y3FC_K_FC[setx])#,method = 'spearman')
    # } )
    # plot(density(CorSample));abline(v=qgenesIDCOR,col=2)  
    # table(CorSample>qgenesIDCOR)
    
  }  
  
  
  pdataMIA <- pdata[pdata$Set == 'Microarray',]
  rns <- levels(pdataMIA$Gene)[c(2,5,6,1,3,4)] ; pdataMIA$Gene <- factor(pdataMIA$Gene, levels = rns)
  rns <- levels(pdataMIA$pid)[c(2,5,6,1,3,4)]  ; pdataMIA$pid <- factor(pdataMIA$pid, levels = rns)
  limits <- aes(ymax = pdataMIA$FC + pdataMIA$stderr , ymin=pdataMIA$FC - pdataMIA$stderr)
  Plot_pdata <- ggplot(pdataMIA,aes(x=factor(Gene),y=FC,fill=factor(Set2))) +  
    geom_bar(position="dodge",stat="identity") + 
    geom_errorbar(limits, position=dodge, width=0.4) +
    ylim(c(-4 ,4)) +
    labs(x = "", y = paste0("Log2-fold change of class ",class),title="SF767 vs 799 - Illumina data") +
    scale_fill_manual(values = cols2[c(1,3)],name="") + 
    thememapBarplot(base_size = base_size,legend_key_size = 0.6) + 
    theme(legend.position="bottom")
  print(Plot_pdata)
  ggsave(plot = Plot_pdata,filename = paste0(plotOUT,'SF767_L799__Array.pdf'),width = 12,height = 8)
  
  

# Barplot -SF767 vs 799 vs MCF7  - Illumina data  -------------------------

  getMDF7 <- function(){  
    wd2 <- '/Volumes/Macintosh HD/Users/weinhol/Promotion/ServerTMP/KapplerWichmann/H_131016_0735_Analysen_ID_9389333093/'
    x <- limma::read.ilmn(files=paste0(wd2,"Einzelanalyse_nonorm_nobkgd.txt")   ,sep="\t",
                          ctrlfiles=paste0(wd2,"ControlProbeProfile_quantile_nobkgd.txt"),
                          other.columns=c("Detection","BEAD_STDERR","Avg_NBEADS")
    )
     
    colnames(x$E) <- c(paste0( c("K","K_EGF","I","I_EGF"), "_1"),
                        paste0( c("K","K_EGF","I","I_EGF"), "_2"),
                        paste0( c("K","K_EGF","I","I_EGF"), "_3"))
    
    colnames(x$other$Detection) <- colnames(x$E)
    colnames(x$other$BEAD_STDERR) <-colnames(x$E)
    colnames(x$other$Avg_NBEADS) <- colnames(x$E)
    
    pe2 <- limma::propexpr(x);
    qqq <- normexp.fit.detection.p(x, detection.p="Detection")
    y2 <- limma::neqc(x,negctrl = "NEGATIVE",detection.p = ExpData$other$Detection ,robust=TRUE,regular = "regular", offset = 16) ; NORM <- "Limma_BG_QN"     #,robust=TRUE)
    head(y2$E)
    
    DetectionPval <- 0.05
    DetectionPvalNumber <- ncol(y2$other$Detection) 
    
    expressed <- rowSums(y2$other$Detection <= DetectionPval) == DetectionPvalNumber #>= 3
    y3 <- y2[expressed,]
    message(
      paste0('genes with detection pval <= ',DetectionPval,' in ',
             DetectionPvalNumber ,' of ',ncol(y3$other$Detection),' Samples --> ',
             sum(stringr::str_count(rownames(y3$E),'ILMN_')), ' of ',
             sum(stringr::str_count(rownames(y2$E),'ILMN_'))
      ))
    
    
    #OLD Matrix              NEW ->  no ALL !!! but 3 replicates !!! 
    #    | -EGF | +EGF|          | -EGF   | +EGF|   
    # K  | 1    | 2   |       K  | 1 x3   | 2 x3  | 
    # ALL| 3    | 4   |       
    # 14 | 5    | 6   |       14 | 5 x3   | 6  x3 |
    
    s0 <- c('K_1','K_2','K_3')
    s1 <- c('K_EGF_1','K_EGF_2','K_EGF_3')
    
    getS1S0log2FC <- function(y2,s0,s1){
      s1M <- rowMeans(as.matrix( y2$E[,s1]) )
      s0M <- rowMeans( as.matrix(y2$E[,s0]) )
      s1s0FC <- s1M - s0M
      
      s1stderr <- apply(as.matrix(y2$E[,s1]),MARGIN = 1, function(row) plotrix::std.error(row,na.rm = T) )
      s0stderr <- apply(as.matrix(y2$E[,s0]),MARGIN = 1, function(row) plotrix::std.error(row,na.rm = T) )
      
      # https://www.researchgate.net/post/Can_anyone_help_with_calculating_error_in_RT-qPCRs_fold-change_data
      s0s1stderr = sqrt( s1stderr^2 +  s0stderr^2)
      
      tmp.dt <- data.table::data.table("rn" = names(s1M), s1M , s0M , s1s0FC , s1stderr, s0stderr, s0s1stderr)                      
      data.table::setkey(tmp.dt,'rn')
      return(tmp.dt)
    }
    FC_K <- getS1S0log2FC(y2,s0 = c('K_1','K_2','K_3'),s1 = c('K_EGF_1','K_EGF_2','K_EGF_3') )
    FC_I <- getS1S0log2FC(y2,s0 = c('I_1','I_2','I_3'),s1 = c('I_EGF_1','I_EGF_2','I_EGF_3') )

    setkey(FC_K,'rn')
    setkey(FC_I,'rn')
    
    
  }
  
  FC_K_qPCR <- FC_K[do.call(c,qgenesIDs),.(rn,s1s0FC,s1stderr)]
  FC_K_qPCR$Gene <- names(qgenesIDs)
  FC_K_qPCR$Set <- 'Microarray'
  FC_K_qPCR$Line <- 'MCF7'
  FC_K_qPCR$pid <- paste0(FC_K_qPCR$Gene,'::',FC_K_qPCR$rn)
  FC_K_qPCR$Set2 <- paste0(FC_K_qPCR$Line,'_',FC_K_qPCR$Set)
  colnames(FC_K_qPCR)[c(1,2,3)] <- c('ExpID','FC','stderr')
  FC_K_qPCR <- FC_K_qPCR[,colnames(pdata),with=F]
  
  cols3 <- RColorBrewer::brewer.pal(11,"PRGn")[c(5,2,9)]
  pdata2 <- rbind(FC_K_qPCR,pdata)
  pdata2MIA <- pdata2[pdata2$Set == 'Microarray',]
  limits <- aes(ymax = pdata2MIA$FC + pdata2MIA$stderr , ymin=pdata2MIA$FC - pdata2MIA$stderr)
  Plot_pdata <- ggplot(pdata2MIA,aes(x=factor(Gene),y=FC,fill=factor(Line))) +  
    geom_bar(position="dodge",stat="identity") + 
    geom_errorbar(limits, position=dodge, width=0.4) +
    ylim(c(-4 ,4)) +
    labs(x = "", y = paste0("Log2-fold change of class ",class),title="SF767 vs 799 vs MCF7 - Illumina data",subtitle="MCF7 log2FC = [Ko+EGF] - [Ko-EGF]") +
    scale_fill_manual(values = cols3,name="") + 
    thememapBarplot(base_size = base_size,legend_key_size = 0.6) + 
    theme(legend.position="bottom")
  print(Plot_pdata)
  ggsave(plot = Plot_pdata,filename = paste0(plotOUT,'SF767_L799_MCF7__Array[c].pdf'),width = 12,height = 8)
  
  SF767_FC_K <- normData767$E[,2] - normData767$E[,1]
  SF767_FC_K_qPCR <- data.table(cbind("Gene"= names(qgenesIDs),'ExpID'=do.call(c,qgenesIDs),'FC'= SF767_FC_K[do.call(c,qgenesIDs)]) )
  SF767_FC_K_qPCR$FC <- as.double(SF767_FC_K_qPCR$FC)
  SF767_FC_K_qPCR$Line <- 'SF767'
  SF767_FC_K_qPCR$stderr <- 0
  
  L799_FC_K <- normData799$E[,2] - normData799$E[,1]
  L799_FC_K_qPCR <- data.table(cbind("Gene"= names(qgenesIDs),'ExpID'=do.call(c,qgenesIDs),'FC'=L799_FC_K[do.call(c,qgenesIDs)]) )
  L799_FC_K_qPCR$FC <- as.double(L799_FC_K_qPCR$FC)
  L799_FC_K_qPCR$Line <- 'L767'
  L799_FC_K_qPCR$stderr <- 0
  
  pdata3 <- rbind(SF767_FC_K_qPCR,L799_FC_K_qPCR,FC_K_qPCR[,colnames(SF767_FC_K_qPCR),with=F])
  limits <- aes(ymax = pdata3$FC + pdata3$stderr , ymin=pdata3$FC - pdata3$stderr)
  Plot_pdata <- ggplot(pdata3,aes(x=factor(Gene),y=FC,fill=factor(Line))) +  
    geom_bar(position="dodge",stat="identity") + 
    geom_errorbar(limits, position=dodge, width=0.4) +
    ylim(c(-4 ,4)) +
    labs(x = "", y = paste0("Log2-fold change of [Ko+EGF] - [Ko-EGF]"),title="SF767 vs 799 vs MCF7 - Illumina data") +
    scale_fill_manual(values = cols3,name="") + 
    thememapBarplot(base_size = base_size,legend_key_size = 0.6) + 
    theme(legend.position="bottom")
  print(Plot_pdata)
  ggsave(plot = Plot_pdata,filename = paste0(plotOUT,'SF767_L799_MCF7__Array[Ko+EGF].pdf'),width = 12,height = 8)
  
  png(paste0(plotOUT,'SF767_L799_MCF7__Array[Ko+EGF]_scatter_SF767_MCF7.png'),width = 20,height = 20,units = 'cm',res=200)
    plot(SF767_FC_K,FC_K[names(SF767_FC_K)]$s1s0FC,pch=20,xlab = 'SF767',ylab = "MCF7",main = "SF767 vs MCF7 - log2FC = [Ko+EGF]-[Ko-EGF]")
  dev.off()
  png(paste0(plotOUT,'SF767_L799_MCF7__Array[Ko+EGF]_scatter_L799_MCF7.png'),width = 20,height = 20,units = 'cm',res=200)
    plot(L799_FC_K,FC_K[names(L799_FC_K)]$s1s0FC,pch=20,xlab = 'L799',ylab = "MCF7",main = "L799 vs MCF7 - log2FC = [Ko+EGF]-[Ko-EGF]")
  dev.off()
  png(paste0(plotOUT,'SF767_L799_MCF7__Array[Ko+EGF]_scatter_SF767_L799.png'),width = 20,height = 20,units = 'cm',res=200)
    plot(SF767_FC_K,L799_FC_K[names(SF767_FC_K)],pch=20,xlab = 'SF767',ylab = "L799",main = "SF767 vs L799 - log2FC = [Ko+EGF]-[Ko-EGF]")
  dev.off()
  
  table(abs(SF767_FC_K)>0.5) / length(SF767_FC_K)
  table(abs(L799_FC_K)>0.5) / length(L799_FC_K)
  table(abs(FC_K[names(SF767_FC_K)]$s1s0FC)>0.5) / nrow(FC_K)
  table(abs(FC_I[names(SF767_FC_K)]$s1s0FC)>0.5) / nrow(FC_I)
  
 
  normData767$E[do.call(c,qgenesIDs),]
  normData799$E[do.call(c,qgenesIDs),]
  FC_K[do.call(c,qgenesIDs),]
  
  pdf(paste0(plotOUT,'SF767_L799_MCF7__Array[Ko+EGF]_rawExp.pdf'),width = 10,height = 13)
    par(mfrow=c(2,1))
    barplot(t(cbind(normData799$E[do.call(c,qgenesIDs),1],FC_K[do.call(c,qgenesIDs),][['s0M']],normData767$E[do.call(c,qgenesIDs),1])),beside = T,col=cols3,legend.text = c('L799','MCF7','SF767'),names.arg = names(qgenesIDs) ,main='[Ko-EGF]',ylab="log2 expression")
    barplot(t(cbind(normData799$E[do.call(c,qgenesIDs),2],FC_K[do.call(c,qgenesIDs),][['s1M']],normData767$E[do.call(c,qgenesIDs),2])),beside = T,col=cols3,legend.text = c('L799','MCF7','SF767'),names.arg = names(qgenesIDs) ,main='[Ko+EGF]',ylab="log2 expression")
  dev.off()
  
  cbind(  normData767$E[do.call(c,qgenesIDs),2],
          normData799$E[do.call(c,qgenesIDs),2],
          FC_K[do.call(c,qgenesIDs),][['s1M']]
  )
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            